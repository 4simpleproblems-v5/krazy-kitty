<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>90s Retro Cat Racer - 3D Texture Mode</title>
    <style>
        /* ========================================
         CSS STYLES - THE 3D ENGINE
         ========================================
        */

        :root {
            /* Perspective: How extreme the 3D vanishing point is. 
               Lower = wider lens, faster sense of speed. */
            --perspective-depth: 400px; 
            /* Horizon level: Where the sky meets the ground (percentage from top) */
            --horizon-level: 45%;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000;
             /* A retro font for UI */
            font-family: 'Courier New', Courier, monospace;
        }

        /* The main camera container */
        #game-viewport {
            position: relative;
            width: 100%;
            height: 100%;
            /* Establish the 3D space */
            perspective: var(--perspective-depth);
            /* Set the vanishing point at the horizon */
            perspective-origin: 50% var(--horizon-level);
            background-color: #333;
        }

        /* --- THE SKYBOX (Parallax Panorama) ---
        */
        .sky-panorama {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            /* Sky takes up space above horizon */
            height: var(--horizon-level);
            z-index: 1;
            overflow: hidden;
        }

        .sky-texture {
            width: 100%;
            height: 100%;
            /* --- LOCAL IMAGE REFERENCE: SKY --- */
            background-image: url('sky.jpg');
            /* Important: repeat-x allows it to scroll infinitely sideways */
            background-repeat: repeat-x;
            /* Cover height, auto width to maintain aspect ratio */
            background-size: auto 100%; 
            background-position: center center;
        }


        /* --- THE 3D TRACK PLANE ---
        */

        /* The container holds the 3D space for the ground */
        .ground-container {
            position: absolute;
            top: var(--horizon-level);
            left: 0;
            width: 100%;
            /* Ground takes space below horizon */
            height: calc(100% - var(--horizon-level));
            /* Crucial: tells children to exist in 3D space */
            transform-style: preserve-3d;
            z-index: 2;
             /* Fade the track into the horizon distance */
            mask-image: linear-gradient(to bottom, transparent 0%, black 25%);
            -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 25%);
        }

        /* The actual 3D plane with the texture */
        .track-plane {
            /* Make it huge so it stretches to the horizon and sides */
            position: absolute;
            width: 400%; 
            left: -150%; /* Center the huge plane horizontally */
            height: 10000px; /* Very long road */
            
            /* --- 3D TRANSFORMATION --- */
            /* Pivot rotation from the top edge (the horizon line) */
            transform-origin: 50% 0%; 
            /* Rotate X axis to lay it flat on the "ground" */
            transform: rotateX(84deg) translateZ(0px);
            
            /* --- LOCAL IMAGE REFERENCE: TRACK --- */
            background-image: url('track.jpg');
            
            /* repeat-y makes the road infinite forward */
            background-repeat: repeat;
            /* Scale the texture so it looks like a road width */
            background-size: 40% auto; 
            background-position: center 0px;
            
            /* Crunchy retro look */
            image-rendering: pixelated; 
            /* Smooth out distant textures slightly */
            will-change: transform, background-position;
        }


        /* --- THE COCKPIT OVERLAY (2D UI) ---
        */

        .cockpit-layer {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: flex-end;
             /* Engine rumble */
            animation: rumble 0.1s infinite linear alternate;
        }

        .cockpit-image {
            width: 100%;
            max-width: 1000px; /* Adjust based on your image resolution */
            display: block;
            /* Ensure sharp edges on the cutout */
             image-rendering: -webkit-optimize-contrast;
             transform-origin: center bottom;
             transition: transform 0.1s ease-out;
        }

        @keyframes rumble {
            0% { transform: translateY(1px); }
            100% { transform: translateY(-1px); }
        }

        /* UI overlay */
        .ui-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 20px;
            z-index: 20;
            text-shadow: 2px 2px 0 #000, -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000;
            font-weight: bold;
            font-style: italic;
        }
        .speed-bar {
            display: inline-block;
            width: 100px;
            height: 15px;
            background: #333;
            border: 2px solid white;
        }
        .speed-fill {
            height: 100%;
            background: linear-gradient(to right, yellow, red);
            width: 50%; /* Dynamic */
        }

    </style>
</head>
<body>

    <div id="game-viewport">
        <div class="sky-panorama">
            <div class="sky-texture" id="skyTex"></div>
        </div>

        <div class="ground-container">
            <div class="track-plane" id="trackPlane"></div>
        </div>

        <div class="cockpit-layer">
            <img src="cockpit.png" alt="Cat Cockpit" class="cockpit-image" id="cockpitImg">
        </div>

        <div class="ui-overlay">
            SPEED: <div class="speed-bar"><div class="speed-fill" id="speedFill"></div></div>
        </div>
    </div>


    <script>
        // --- Setup Elements ---
        const trackPlane = document.getElementById('trackPlane');
        const skyTex = document.getElementById('skyTex');
        const cockpitImg = document.getElementById('cockpitImg');
        const speedFill = document.getElementById('speedFill');
        
        // --- Game State Variables ---
        let speed = 0;
        let maxSpeed = 60;
        let acceleration = 0.5;
        let deceleration = 0.3;
        
        let trackPositionY = 0; // Moving forward
        let trackPositionX = 50; // Center percentage
        
        let skyPositionX = 0; // Sky horizontal scroll for turning illusion
        
        // --- Controls Setup ---
        let turningInput = 0; // -1 left, 1 right
        let gasInput = false;
        const keys = {};

        document.addEventListener('keydown', (e) => { keys[e.key] = true; });
        document.addEventListener('keyup', (e) => { keys[e.key] = false; });


        // --- Main Game Loop (60fps target) ---
        function gameLoop() {
            // 1. Handle Inputs
            turningInput = 0;
            if(keys['ArrowLeft']) turningInput = -1;
            if(keys['ArrowRight']) turningInput = 1;
            gasInput = keys['ArrowUp'];

            // 2. Calculate Speed Physics
            if (gasInput) {
                if (speed < maxSpeed) speed += acceleration;
            } else {
                if (speed > 0) speed -= deceleration;
            }
            // Clamp speed so it doesn't go negative or over max
            speed = Math.max(0, Math.min(speed, maxSpeed));

            // Update UI Speedometer
            const speedPercent = (speed / maxSpeed) * 100;
            speedFill.style.width = `${speedPercent}%`;


            // 3. Update World Positions depending on speed
            if (speed > 0) {
                // Move Track Forward
                trackPositionY += speed * 2;

                // Move Track Sideways (turning)
                // We multiply by speed so turning is sharper at high speed
                trackPositionX += turningInput * (speed / 30);

                // Move Sky Sideways (Parallax)
                // Move the sky slower than the track turning to create depth
                skyPositionX -= turningInput * (speed / 80);
            }


            // 4. Apply Visuals to CSS
            
            // Apply Track texture position
            // positionX changes center %, positionY changes vertical pixels
            trackPlane.style.backgroundPosition = `${trackPositionX}% ${trackPositionY}px`;

            // Apply Sky texture position (scrolling horizontally)
            skyTex.style.backgroundPosition = `${skyPositionX}px center`;
            
            // Tilt the cockpit image slightly when turning
            const tiltAmount = turningInput * (speed / maxSpeed) * 4; // Max 4 degrees tilt
            cockpitImg.style.transform = `rotate(${-tiltAmount}deg)`;


            // Loop
            requestAnimationFrame(gameLoop);
        }

        // Start engine
        gameLoop();

    </script>
</body>
</html>
